{% load static %}

<style>
.global-loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--body-bg);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.3s ease-out;
}

.global-loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid var(--border-color);
    border-top: 4px solid var(--link-fg);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.form-loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(var(--body-bg-rgb), 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease-out;
}

.form-loading-overlay.active {
    opacity: 1;
    pointer-events: auto;
}

.loading-text {
    margin-top: 15px;
    color: var(--body-quiet-color);
    font-size: 14px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<div class="global-loading-overlay">
    <div style="text-align: center;">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle global page loading
    const globalLoadingOverlay = document.querySelector('.global-loading-overlay');
    if (globalLoadingOverlay) {
        globalLoadingOverlay.classList.add('hidden');
    }

    // Initialize form loading overlays
    function initFormLoadingOverlays() {
        document.querySelectorAll('form').forEach(form => {
            // Only add loading overlay if form doesn't already have one
            if (!form.querySelector('.form-loading-overlay')) {
                const overlay = document.createElement('div');
                overlay.className = 'form-loading-overlay';
                overlay.innerHTML = `
                    <div style="text-align: center;">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Sending...</div>
                    </div>
                `;
                
                // Make sure form has position relative for overlay positioning
                if (getComputedStyle(form).position === 'static') {
                    form.style.position = 'relative';
                }
                
                form.appendChild(overlay);
                
                form.addEventListener('submit', function() {
                    const submitButtons = form.querySelectorAll('input[type="submit"], button[type="submit"]');
                    submitButtons.forEach(button => {
                        button.disabled = true;
                        if (button.tagName === 'INPUT') {
                            button.value = 'Sending...';
                        } else {
                            button.textContent = 'Sending...';
                        }
                    });
                    overlay.classList.add('active');
                });
            }
        });
    }

    // Initialize on page load
    initFormLoadingOverlay();

    // Initialize when content changes (for dynamically loaded forms)
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.addedNodes.length) {
                initFormLoadingOverlays();
            }
        });
    });

    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
});
</script> 